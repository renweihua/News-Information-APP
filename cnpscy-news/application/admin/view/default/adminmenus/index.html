{extend name="layout::default" /}

{block name="title"}菜单列表{/block}

{block name="content"}
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>菜单列表</h5>
                <div class="ibox-tools float-left">
                    &nbsp;
                    <a class=javascript:;" onclick="getList()" title="数据重载">
                        <i class="fa fa-spin fa-refresh"></i>
                    </a>
                    &nbsp;
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    &nbsp;
                </div>
            </div>
            <div class="ibox-title">
                <div class="row">
                    <form action="" method="post" id="form_data" class="first_form float-left"
                          ajax-url="{:url('index')}" onsubmit="getList();return false;">
                        <div class="col-sm-3">
                            <a onclick="hrefUrl('{:url(\'detail\')}')" href="javascript:void(0);"
                               class="btn btn-primary "> <i class="fa fa-plus"></i> 添加菜单</a>
                        </div>
                        <input type="hidden" name="start_function" value="0">
                        <input type="hidden" name="page" value="1">
                        <input type="hidden" name="limit" value="10">
                        <input type="hidden" name="order" value="ASC">
                        <div class="col-sm-3 col-xs-6 col-md-2 m-b-xs float-right">
                            <div class="input-group">
                                <input type="text" placeholder="请输入关键词" class="input-sm form-control" name="search">
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-sm btn-primary"
                                            onclick="getList()"> 搜索</button>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-3 col-xs-6 col-md-2 m-b-xs float-right">
                            <select class="input form-control input-s-sm inline" name="check_auth">
                                <option value="-1"> 权限状态 </option>
                                <option value="1"> 检测 </option>
                                <option value="0"> 不检测 </option>
                            </select>
                        </div>
                        <div class="col-sm-3 col-xs-6 col-md-2 m-b-xs float-right">
                            <select class="input form-control input-s-sm inline" name="parent_id">
                                <option value="0"> 请选择父级栏目 </option>
                            </select>
                        </div>
                        <div class="col-sm-3 col-xs-6 col-md-2 m-b-xs float-right">
                            <select class="input form-control input-s-sm inline" name="is_check">
                                <option value="-1">请选择状态</option>
                                <option value="0">禁用</option>
                                <option value="1">正常</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="clearfix hidden-xs"></div>
            </div>
            <div class="ibox-content">
                <div class="row">
                    <table class="table footable table-bordered table-striped table-stripped toggle-arrow-tiny table-hover">
                        <thead>
                        <tr>
                            <th class="text-center"> Id </th>
                            <th class="text-center"> 菜单名称 </th>
                            <th class="text-center hidden-sm hidden-xs hidden-md"> 页面路由 </th>
                            <th class="text-center hidden-sm"> 接口地址 </th>
                            <th class="text-center hidden-sm"> 权限检测 </th>
                            <th class="text-center hidden-sm"> 左侧展示 </th>
                            <th class="text-center hidden-sm"> 菜单状态 </th>
                            <th class="text-center hidden-sm hidden-xs hidden-md"> 创建/更新时间 </th>
                            <th class="text-center hidden-sm hidden-xs hidden-md"> 排序 </th>
                            <th class="text-center"> 操作 </th>
                        </tr>
                        </thead>
                        <tbody class="contentList"></tbody>
                    </table>
                    <div class="clearfix hidden-xs"></div>
                    <hr>
                    <div id="pageList" class="float-right"></div>
                    <div class="clearfix hidden-xs"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script type="text/javascript">
    window.onload = function () {
        window.onloadCallback = checkboxClass;
        closeLayerLoading(getList);
        getMenusSelectList('{:url("getSelectLists")}', 0, $('form#form_data select[name=parent_id]'));
    }
</script>
<script id="form_list" type="text/html">
    <<{#  if(d.status != 1 || isEmpty(d.data.data)){ }>>
    <tr class="text-center">
        <td colspan="100"> <<{ d.msg || '暂无数据！' }>></td>
    </tr>
    <<{#  }else{ }>>
    <<{#  layui.each(d.data.data, function(index, item){ }>>
        <tr id="id_<<{=item.menu_id}>>" name="<<{=item.menu_name}>>">
            <td class="text-center"><a href="javascript:;"> <<{=item.menu_id}>> </a></td>
            <td class="text-center"> <<{=item.menu_name}>> </td>
            <td class="text-center hidden-sm hidden-xs hidden-md"> <<{=item.menu_url}>> </td>
            <td class="text-center hidden-sm"> <<{=item.api_url}>> </td>
            <td class="text-center hidden-sm">
                <<{# if(item.check_auth == 1){ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'check_auth', 'change_value':0})"
                       checked=""/>
                <<{# }else{ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'check_auth', 'change_value':1})"/>
                <<{# } }>>
            </td>
            <td class="text-center hidden-sm">
                <<{# if(item.is_left == 1){ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'is_left', 'change_value':0})"
                       checked=""/>
                <<{# }else{ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'is_left', 'change_value':1})"/>
                <<{# } }>>
            </td>
            <td class="text-center hidden-sm">
                <<{# if(item.is_check == 1){ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'is_check', 'change_value':0})"
                       checked=""/>
                <<{# }else{ }>>
                <input type="checkbox" class="js-switch"
                       onchange="changeFiledStatus(this, '{:url(\'changeFiledStatus\')}', {'menu_id' : '<<{=item.menu_id}>>', 'change_field' : 'is_check', 'change_value':1})"/>
                <<{# } }>>
            </td>
            <td class="text-center hidden-sm hidden-xs hidden-md">
                <<{=item.create_time ? TimeTransformationDate(item.create_time, true, true, true, true, true) : ''}>>
                <br>
                <<{=item.update_time ? TimeTransformationDate(item.update_time, true, true, true, true, true) : ''}>>
            </td>
            <td class="text-center hidden-sm hidden-xs hidden-md">
                <input type="number" name="menu_sort" value="<<{item.menu_sort}>>" class="center width-50-percentage line-height-25-px">
            </td>
            <td class="text-center">
                <button class="btn btn-xs btn-info" title="编辑“<<{=item.menu_name}>>”"
                        onclick="hrefUrl('{:url(\'detail\')}?menu_id=<<{=item.menu_id}>>')"><i
                        class="fa fa-pencil"></i> 编辑
                </button>
                <button class="btn btn-xs btn-danger" title="删除“<<{=item.menu_name}>>”"
                        onclick="delOperation('<<{item.menu_id}>>', '{:url(\'delete\')}')"><i class="fa fa-times"></i> 删除
                </button>
            </td>
        </tr>
    <<{#  }); }>>
    <<{#  } }>>
</script>
{/block}